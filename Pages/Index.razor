@page "/"
@using DigitalNetWeb.Data.Models;
@using DigitalNetWeb.Data.ModelService;

<head>
    <link rel="shortcut icon" type="image/ico" href="/favicon.ico" />
    <link rel="icon" type="image/ico" href="/favicon.ico" />
    <link rel="apple-touch-icon" type="image/ico" href="/favicon.ico" />

</head>

<body>
    <div>
        <div class="input-group">
            <div class="form-outline">
                <input type="input" class="form-control" id="inputSearch" placeholder="Search">
            </div>
            <button type="button" class="btn btn-primary">
                <i class="oi oi-magnifying-glass"></i>
            </button>
        </div>
    </div>

    <br>

    @if (Digimonlist == null)
    {
        <p><em>Loading...</em></p>
    }
    else
    {
        <div class="container">
            <div class="item-wrapper">
                @for (int i = @StartLoop; i <= @EndLoop; i++)
                {
                    Digimon digimon = Digimonlist[i];
                    <SearchCard ob=@digimon name=@digimon.EngName icon=@digimon.IconLink />
                }
            </div>
            <div id="pages">
                <div class="d-flex justify-content-center">
                    <p class="btn btn-secondary" @onclick="previous">Back</p>
                    <p class="btn btn-primary" @onclick="next">Next</p>
                </div>
                <div class="d-flex justify-content-center">
                    <p id="currentPage" class="align-text-bottom">Page <strong>@PageIndex</strong> of
                        <strong>@TotalPages</strong></p>
                </div>
            </div>
        </div>
    }

</body>

@code {
    private Digimon[]? Digimonlist;
    private int PageIndex = 0;
    private int TotalPages = 0;
    private int IconsPerPage = 149; // number of icons you want shown on each page
    private int StartLoop = 0;
    private int EndLoop = 0;
    protected override async Task OnInitializedAsync()
    {
        Digimonlist = await new DigimonService().GetDigimonDBAsync();
        TotalPages = (Digimonlist.Length - 1) / (IconsPerPage + 1);
        EndLoop = IconsPerPage;
    }

    private void next()
    {
        LoadPage(true);
    }

    private void previous()
    {
        LoadPage(false);
    }

    private void LoadPage(bool pgNext)
    {
        // make sure there is another page before adding 1 to the PageIndex
        if (pgNext & (PageIndex + 1) * IconsPerPage < Digimonlist.Length)
            PageIndex += 1;
        else if (!pgNext & PageIndex - 1 >= 0)
            PageIndex -= 1;
        else
            return;// exit the sub if already on Page1 or on the Last Page

        int endpage = Math.Min(((PageIndex * IconsPerPage) + IconsPerPage), Digimonlist.Length - 1);

        int i = 0;
        if (PageIndex != 0)
        {
            i += PageIndex;
            endpage = Math.Min(((PageIndex * IconsPerPage) + IconsPerPage + PageIndex), Digimonlist.Length - 1);
        }
        i += (PageIndex * IconsPerPage);
        StartLoop = i;
        EndLoop = endpage;
    }
}
